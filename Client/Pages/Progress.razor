@page "/progress"
@using Cloudcrate.AspNetCore.Blazor.Browser.Storage;
@inject HttpClient Http
@inject LocalStorage Storage
@inject NavigationManager NavigationManager
<h1>Progress Check</h1>

<div id="unregistered" style="@(string.IsNullOrWhiteSpace(TeamName) ? "display:block" : "display:none")">
    <p>
        It looks like you haven't even started yet! Are you ready? [let's go link]
    </p>
</div>

<div id="registered" style="@(!string.IsNullOrWhiteSpace(TeamName) ? "display:block" : "display:none")">
    <h3>Welcome @TeamName</h3>
    <p>
        Here's what you've accomplished so far:
    </p>
    <p>
        Completed Puzzle list
    </p>
    <p>
        Current puzzle [with link]
    </p>
</div>

@*<p>Current count: @currentCount</p>

    <button class="btn btn-primary" @onclick="IncrementCount">Click me</button>
*@

@code {
    private string TeamName;

    private PuzzlePortal.Shared.ScoreSheetModel scoreSheetModel = new PuzzlePortal.Shared.ScoreSheetModel();

    protected override async Task OnInitializedAsync()
    {
        var scoreSheet = Storage.GetItem<PuzzlePortal.Shared.ScoreSheetModel>("scoreSheet");
        if (scoreSheet == null)
        {
            Console.WriteLine("No active scoresheet!");
        }
        else
        {
            Console.WriteLine($"Loaded scoresheet for {scoreSheet.Name}");
            TeamName = scoreSheet.Name;
            var content = new StringContent(System.Text.Json.JsonSerializer.Serialize(scoreSheet), System.Text.Encoding.UTF8, "application/json");
            var response = await Http.PostAsync("api/ScoreSheet", content);
            if (response.StatusCode == System.Net.HttpStatusCode.Unauthorized)
                NavigationManager.NavigateTo("https://www.youtube.com/watch?v=dQw4w9WgXcQ");
        }
    }
}
